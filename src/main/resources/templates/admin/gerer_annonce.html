<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Gérer les annonces - Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>

<body class="bg-light">

<div class="container mt-5">
    <h1 class="mb-4">Gérer les annonces</h1>

    <table class="table table-striped table-bordered align-middle">
        <thead class="table-dark">
        <tr>
            <th>ID</th>
            <th>Titre</th>
            <th>Description</th>
            <th>Prix</th>
            <th>Ville</th>
            <th>État</th>
            <th>Actions</th>
        </tr>
        </thead>

        <tbody>
        <tr th:each="a : ${annonces}">
            <td th:text="${a.id}"></td>
            <td th:text="${a.titre}"></td>
            <td th:text="${a.description}"></td>
            <td th:text="${a.prix} + ' DA'"></td>
            <td th:text="${a.ville}"></td>

            <!-- ETAT -->
            <td>
                <span th:if="${a.etat.name() == 'VALIDE'}" class="badge bg-success">Valide</span>
                <span th:if="${a.etat.name() == 'EN_ATTENTE'}" class="badge bg-warning text-dark">En attente</span>
                <span th:if="${a.etat.name() == 'ANNULEE'}" class="badge bg-danger">Annulée</span>
            </td>

            <!-- ACTIONS -->
            <td>
                <!-- Valider -->
                <form th:if="${a.etat.name() == 'EN_ATTENTE'}"
                      th:action="@{/admin/annonces/valider/{id}(id=${a.id})}"
                      method="post" style="display:inline">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <button class="btn btn-success btn-sm">Valider</button>
                </form>

                <!-- Annuler (modal) -->
                <button th:if="${a.etat.name() == 'EN_ATTENTE'}"
                        class="btn btn-danger btn-sm"
                        data-bs-toggle="modal"
                        th:data-bs-target="'#annulerModal-' + ${a.id}">
                    Annuler
                </button>

                <!-- MODAL -->
                <div class="modal fade" th:id="'annulerModal-' + ${a.id}" tabindex="-1">
                    <div class="modal-dialog">
                        <form class="modal-content"
                              th:action="@{/admin/annonces/annuler/{id}(id=${a.id})}"
                              method="post">

                            <input type="hidden" th:name="${_csrf.parameterName}"
                                   th:value="${_csrf.token}"/>

                            <div class="modal-header">
                                <h5 class="modal-title">Cause d'annulation</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>

                            <div class="modal-body">
                                <textarea name="causeAnnulation"
                                          class="form-control"
                                          required
                                          placeholder="Expliquez la cause d'annulation..."></textarea>
                            </div>

                            <div class="modal-footer">
                                <button type="submit" class="btn btn-danger">Envoyer</button>
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                            </div>

                        </form>
                    </div>
                </div>
            </td>
        </tr>
        </tbody>
    </table>
</div>

</body>
</html>
